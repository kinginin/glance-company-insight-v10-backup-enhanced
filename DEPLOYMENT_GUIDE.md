# 公司管理系统 - 部署与使用指南

## 概述

本文档旨在指导您如何将公司管理系统部署到服务器，并通过专用的桌面客户端进行访问。项目已改造为前后端分离的架构，包含三个核心部分：

1.  **Web 前端应用**：使用 React 构建的用户界面，负责所有内容的展示和交互。
2.  **Node.js 后端服务**：一个轻量级的服务器，负责托管前端应用文件，并提供数据存储接口，取代了原有的浏览器本地存储（localStorage）。
3.  **Electron 桌面客户端**：一个类似浏览器的可执行程序（EXE），用于连接并显示服务器上的管理系统界面。

---

## 第一部分：服务器部署

您需要在服务器上执行以下步骤来运行管理系统。

### 部署环境要求

-   **操作系统**：Windows Server、Linux (Ubuntu, CentOS) 或 macOS。
-   **运行环境**：**Node.js** (版本 16.x 或更高)。

### 部署步骤

#### 步骤 1：上传项目文件

将解压后的 `glance-company-insight` 文件夹完整上传到您的服务器。

#### 步骤 2：构建前端应用

在部署前，需要先生成前端的静态文件。请在服务器上打开命令行工具（如 CMD、PowerShell 或终端），进入项目根目录，并执行以下命令：

```bash
# 安装项目依赖 (首次部署或更新依赖后需要执行)
pnpm install

# 构建前端应用
pnpm run build
```

执行成功后，所有前端文件将被打包到项目根目录下的 `dist` 文件夹中。

#### 步骤 3：配置服务器

打开 `server/config.json` 文件，您可以根据实际需求修改服务器配置。

```json
{
  "server": {
    "port": 3000,       // 服务器运行端口，确保此端口未被占用
    "host": "0.0.0.0"  // 监听地址，"0.0.0.0" 表示监听所有网络接口
  },
  "app": {
    "title": "公司管理系统",
    "version": "2.0.0"
  },
  "security": {
    "inviteCode": "admin" // 新用户注册时使用的邀请码
  },
  "database": {
    "type": "file",
    "dataDir": "./data" // 数据文件存储目录，相对于 server 目录
  }
}
```

| 配置项 | 说明 |
| :--- | :--- |
| `server.port` | 服务器监听的端口号。客户端将通过此端口访问。 |
| `server.host` | 服务器监听的 IP 地址。`0.0.0.0` 是标准配置，允许局域网内其他计算机访问。 |
| `security.inviteCode` | 新用户注册时必须提供的邀请码，您可以修改为更复杂的字符串以提高安全性。 |

#### 步骤 4：启动服务器

我们提供了便捷的启动脚本，您无需手动输入命令。

-   **在 Windows 上**：
    直接双击项目根目录下的 `启动服务器.bat` 文件即可。

-   **在 Linux / macOS 上**：
    在项目根目录打开终端，执行以下命令：
    ```bash
    # 首次运行时需要赋予脚本执行权限
    chmod +x ./start-server.sh

    # 启动服务器
    ./start-server.sh
    ```

服务器成功启动后，您会看到类似下面的提示信息，表示系统正在运行。

> **注意**：请勿关闭此命令行窗口，关闭窗口将导致服务器停止服务。

#### 步骤 5：配置防火墙

如果您的服务器开启了防火墙，请务必**开放您在 `config.json` 中配置的端口**（默认为 `3000`），否则客户端将无法连接。

---

## 第二部分：桌面客户端使用

桌面客户端（EXE 程序）需要您在开发环境中自行构建。构建完成后，您可以将生成的安装包或便携版程序分发给公司内部的其他电脑使用。

### 构建客户端步骤

1.  进入项目文件夹中的 `client-app` 目录。
2.  **在 Windows 上**，直接双击 `构建客户端.bat` 文件。
3.  脚本会自动安装所需依赖并开始构建。
4.  构建成功后，会在 `client-app/dist` 目录下生成安装程序 (`.exe`) 和便携版 (`.exe`)。

### 客户端配置与使用

1.  在任何一台需要访问系统的电脑上，安装或运行客户端程序。
2.  首次打开时，如果无法连接到默认地址，程序会显示"无法连接到服务器"的错误页面。
3.  点击 **“设置”** 按钮，在弹出的窗口中输入服务器的正确地址。
    -   格式为：`http://<服务器的IP地址>:<端口>`
    -   例如：`http://192.168.1.10:3000`
4.  点击 **“保存并连接”**，客户端将加载管理系统界面，后续打开将自动连接此地址。

---

## 数据管理

-   **数据存储**：所有用户和项目数据现在都以 JSON 文件的形式存储在服务器的 `server/data` 目录中。这确保了数据的集中管理。
-   **数据备份**：请定期备份 `server/data` 文件夹以防数据丢失。

## 后续建议

-   **数据库升级**：当前的文件数据库适用于中小型团队。如果用户量和数据量较大，建议将后端改造为连接专业的数据库，如 MySQL 或 PostgreSQL。
-   **HTTPS 加密**：为了提高数据传输的安全性，建议为服务器部署 SSL 证书并启用 HTTPS 访问。
