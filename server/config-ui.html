<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å…¬å¸ç®¡ç†ç³»ç»Ÿ - æœåŠ¡å™¨é…ç½®</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Microsoft YaHei', 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    
    .container {
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      width: 100%;
      max-width: 900px;
      overflow: hidden;
    }
    
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      text-align: center;
    }
    
    .header h1 {
      font-size: 24px;
      margin-bottom: 8px;
    }
    
    .header p {
      opacity: 0.9;
      font-size: 14px;
    }
    
    .tabs {
      display: flex;
      border-bottom: 2px solid #f0f0f0;
    }
    
    .tab {
      flex: 1;
      padding: 15px;
      text-align: center;
      cursor: pointer;
      font-weight: 500;
      color: #666;
      transition: all 0.3s;
      border-bottom: 3px solid transparent;
    }
    
    .tab:hover {
      color: #667eea;
      background: #f8f9fa;
    }
    
    .tab.active {
      color: #667eea;
      border-bottom-color: #667eea;
    }
    
    .tab-content {
      display: none;
      padding: 30px;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .section {
      margin-bottom: 25px;
    }
    
    .section-title {
      font-size: 16px;
      font-weight: 600;
      color: #333;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #f0f0f0;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .section-title::before {
      content: '';
      width: 4px;
      height: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 2px;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: #555;
      font-weight: 500;
      font-size: 14px;
    }
    
    .form-group input,
    .form-group select {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 15px;
      transition: all 0.3s;
      background: #fafafa;
    }
    
    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #667eea;
      background: white;
      box-shadow: 0 0 0 3px rgba(102,126,234,0.1);
    }
    
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }
    
    .form-row-3 {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 15px;
    }
    
    .hint {
      color: #888;
      font-size: 12px;
      margin-top: 6px;
    }
    
    .status-bar {
      background: #f8f9fa;
      padding: 15px 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .status-indicator {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #ccc;
    }
    
    .status-indicator.running {
      background: #22c55e;
      animation: pulse 2s infinite;
    }
    
    .status-indicator.stopped {
      background: #ef4444;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .buttons {
      display: flex;
      gap: 15px;
      margin-top: 30px;
    }
    
    button {
      flex: 1;
      padding: 14px 20px;
      border: none;
      border-radius: 8px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(102,126,234,0.4);
    }
    
    .btn-secondary {
      background: #f0f0f0;
      color: #333;
    }
    
    .btn-secondary:hover {
      background: #e0e0e0;
    }
    
    .btn-success {
      background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
      color: white;
    }
    
    .btn-success:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(34,197,94,0.4);
    }
    
    .btn-danger {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: white;
    }
    
    .btn-danger:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(239,68,68,0.4);
    }
    
    .btn-small {
      flex: none;
      padding: 8px 16px;
      font-size: 13px;
    }
    
    .info-box {
      background: #e0f2fe;
      border: 1px solid #7dd3fc;
      border-radius: 8px;
      padding: 15px;
      margin-top: 20px;
    }
    
    .info-box h4 {
      color: #0369a1;
      margin-bottom: 8px;
      font-size: 14px;
    }
    
    .info-box p {
      color: #0c4a6e;
      font-size: 13px;
      line-height: 1.6;
    }
    
    .info-box code {
      background: rgba(0,0,0,0.1);
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Consolas', monospace;
    }
    
    .user-table {
      width: 100%;
      border-collapse: collapse;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      overflow: hidden;
    }
    
    .user-table th,
    .user-table td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid #e0e0e0;
    }
    
    .user-table th {
      background: #f8f9fa;
      font-weight: 600;
      color: #333;
      font-size: 14px;
    }
    
    .user-table tr:last-child td {
      border-bottom: none;
    }
    
    .user-table tr:hover td {
      background: #f8f9fa;
    }
    
    .user-table td {
      font-size: 14px;
      color: #555;
    }
    
    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }
    
    .badge-admin { background: #fee2e2; color: #dc2626; }
    .badge-leader { background: #fef3c7; color: #d97706; }
    .badge-manager { background: #dbeafe; color: #2563eb; }
    .badge-deputy { background: #e0e7ff; color: #4f46e5; }
    .badge-employee { background: #f3f4f6; color: #6b7280; }
    
    .dept-badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 8px;
      font-size: 11px;
      background: #ecfdf5;
      color: #059669;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
      margin-bottom: 25px;
    }
    
    .stat-card {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 15px;
      text-align: center;
    }
    
    .stat-card .number {
      font-size: 28px;
      font-weight: 700;
      color: #333;
    }
    
    .stat-card .label {
      font-size: 12px;
      color: #666;
      margin-top: 5px;
    }
    
    .stat-card.admin .number { color: #dc2626; }
    .stat-card.leader .number { color: #d97706; }
    .stat-card.manager .number { color: #2563eb; }
    .stat-card.employee .number { color: #059669; }
    
    .footer {
      background: #f8f9fa;
      padding: 20px 30px;
      text-align: center;
      color: #666;
      font-size: 13px;
      border-top: 1px solid #e0e0e0;
    }
    
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #333;
      color: white;
      padding: 15px 25px;
      border-radius: 8px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.3);
      transform: translateX(120%);
      transition: transform 0.3s;
      z-index: 1000;
    }
    
    .toast.show {
      transform: translateX(0);
    }
    
    .toast.success {
      background: #22c55e;
    }
    
    .toast.error {
      background: #ef4444;
    }
    
    .empty-state {
      text-align: center;
      padding: 40px;
      color: #888;
    }
    
    .filter-bar {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .filter-bar select {
      padding: 8px 12px;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      font-size: 13px;
      background: white;
    }
    
    .filter-bar select:focus {
      outline: none;
      border-color: #667eea;
    }
    
    @media (max-width: 768px) {
      .form-row, .form-row-3 {
        grid-template-columns: 1fr;
      }
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      .user-table {
        font-size: 12px;
      }
      .user-table th, .user-table td {
        padding: 8px 10px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ¢ å…¬å¸ç®¡ç†ç³»ç»Ÿ</h1>
      <p>æœåŠ¡å™¨é…ç½®ä¸ç”¨æˆ·ç®¡ç†</p>
    </div>
    
    <div class="tabs">
      <div class="tab active" onclick="switchTab('server')">âš™ï¸ æœåŠ¡å™¨è®¾ç½®</div>
      <div class="tab" onclick="switchTab('users')">ğŸ‘¥ è´¦å·ç®¡ç†</div>
      <div class="tab" onclick="switchTab('managers')">ğŸ‘” æ³¨å†Œè´¦å·</div>
      <div class="tab" onclick="switchTab('backup')">ğŸ’¾ æ•°æ®å¤‡ä»½</div>
    </div>
    
    <!-- æœåŠ¡å™¨è®¾ç½® -->
    <div class="tab-content active" id="tab-server">
      <div class="status-bar">
        <div class="status-indicator" id="statusIndicator"></div>
        <span id="statusText">æ£€æµ‹æœåŠ¡å™¨çŠ¶æ€...</span>
      </div>
      
      <div class="section">
        <div class="section-title">æœåŠ¡å™¨è®¾ç½®</div>
        <div class="form-row">
          <div class="form-group">
            <label>ç›‘å¬ç«¯å£</label>
            <input type="number" id="port" value="3000" min="1" max="65535">
            <p class="hint">é»˜è®¤ç«¯å£ 3000</p>
          </div>
          <div class="form-group">
            <label>ç›‘å¬åœ°å€</label>
            <select id="host">
              <option value="0.0.0.0">æ‰€æœ‰ç½‘ç»œæ¥å£ (0.0.0.0)</option>
              <option value="127.0.0.1">ä»…æœ¬æœº (127.0.0.1)</option>
            </select>
            <p class="hint">é€‰æ‹©"æ‰€æœ‰ç½‘ç»œæ¥å£"å…è®¸å±€åŸŸç½‘è®¿é—®</p>
          </div>
        </div>
      </div>
      
      <div class="section">
        <div class="section-title">å®‰å…¨è®¾ç½®</div>
        <div class="form-group">
          <label>æ³¨å†Œé‚€è¯·ç </label>
          <input type="text" id="inviteCode" value="admin" placeholder="æ–°ç”¨æˆ·æ³¨å†Œæ—¶éœ€è¦çš„é‚€è¯·ç ">
          <p class="hint">æ–°ç”¨æˆ·æ³¨å†Œæ—¶å¿…é¡»è¾“å…¥æ­¤é‚€è¯·ç æ‰èƒ½åˆ›å»ºè´¦å·ï¼ˆä¿®æ”¹åéœ€é‡å¯æœåŠ¡å™¨ç”Ÿæ•ˆï¼‰</p>
        </div>
      </div>
      
      <div class="section">
        <div class="section-title">åº”ç”¨ä¿¡æ¯</div>
        <div class="form-row">
          <div class="form-group">
            <label>ç³»ç»Ÿåç§°</label>
            <input type="text" id="appTitle" value="å…¬å¸ç®¡ç†ç³»ç»Ÿ">
          </div>
          <div class="form-group">
            <label>ç‰ˆæœ¬å·</label>
            <input type="text" id="appVersion" value="3.0.0" readonly>
          </div>
        </div>
      </div>
      
      <div class="buttons">
        <button class="btn-secondary" onclick="loadConfig()">
          ğŸ”„ é‡æ–°åŠ è½½
        </button>
        <button class="btn-primary" onclick="saveConfig()">
          ğŸ’¾ ä¿å­˜é…ç½®
        </button>
      </div>
      
      <div class="info-box">
        <h4>ğŸ’¡ ä½¿ç”¨è¯´æ˜</h4>
        <p>
          1. ä¿®æ”¹é…ç½®åç‚¹å‡»"ä¿å­˜é…ç½®"<br>
          2. é‡å¯æœåŠ¡å™¨ä½¿é…ç½®ç”Ÿæ•ˆ<br>
          3. å®¢æˆ·ç«¯é€šè¿‡ <code>http://æœåŠ¡å™¨IP:ç«¯å£</code> è®¿é—®<br>
          4. é‚€è¯·ç ä¿®æ”¹åï¼Œå‰ç«¯æ³¨å†Œé¡µé¢å°†ä½¿ç”¨æ–°çš„é‚€è¯·ç 
        </p>
      </div>
    </div>
    
    <!-- è´¦å·ç®¡ç† -->
    <div class="tab-content" id="tab-users">
      <div class="stats-grid">
        <div class="stat-card admin">
          <div class="number" id="adminCount">0</div>
          <div class="label">ç®¡ç†å‘˜</div>
        </div>
        <div class="stat-card leader">
          <div class="number" id="leaderCount">0</div>
          <div class="label">é¢†å¯¼</div>
        </div>
        <div class="stat-card manager">
          <div class="number" id="managerCount">0</div>
          <div class="label">ç»ç†/å‰¯ç»ç†</div>
        </div>
        <div class="stat-card employee">
          <div class="number" id="employeeCount">0</div>
          <div class="label">æ™®é€šå‘˜å·¥</div>
        </div>
      </div>
      
      <div class="section">
        <div class="section-title">æ‰€æœ‰è´¦å·åˆ—è¡¨</div>
        
        <div class="filter-bar">
          <select id="filterRole" onchange="filterUsers()">
            <option value="">å…¨éƒ¨è§’è‰²</option>
            <option value="admin">ç®¡ç†å‘˜</option>
            <option value="leader">é¢†å¯¼</option>
            <option value="manager">éƒ¨é—¨ç»ç†</option>
            <option value="deputy_manager">å‰¯ç»ç†</option>
            <option value="employee">æ™®é€šå‘˜å·¥</option>
          </select>
          <select id="filterDept" onchange="filterUsers()">
            <option value="">å…¨éƒ¨éƒ¨é—¨</option>
            <option value="design">è®¾è®¡éƒ¨</option>
            <option value="procurement">é‡‡è´­éƒ¨</option>
            <option value="production">ç”Ÿäº§éƒ¨</option>
            <option value="assembly">è£…è°ƒéƒ¨</option>
            <option value="electrical">ç”µæ°”éƒ¨</option>
            <option value="quality">è´¨é‡éƒ¨</option>
          </select>
        </div>
        
        <div id="userTableContainer">
          <table class="user-table">
            <thead>
              <tr>
                <th>ç”¨æˆ·å</th>
                <th>å§“å</th>
                <th>è§’è‰²</th>
                <th>éƒ¨é—¨</th>
                <th>æ³¨å†Œæ—¶é—´</th>
                <th>æ“ä½œ</th>
              </tr>
            </thead>
            <tbody id="userTableBody">
              <tr><td colspan="6" class="empty-state">åŠ è½½ä¸­...</td></tr>
            </tbody>
          </table>
        </div>
      </div>
      
      <div class="buttons">
        <button class="btn-secondary" onclick="loadUsers()">
          ğŸ”„ åˆ·æ–°åˆ—è¡¨
        </button>
      </div>
    </div>
    
    <!-- æ³¨å†Œè´¦å· -->
    <div class="tab-content" id="tab-managers">
      <div class="section">
        <div class="section-title">æ³¨å†Œé¢†å¯¼è´¦å·</div>
        <p class="hint" style="margin-bottom: 15px;">é¢†å¯¼è´¦å·æ‹¥æœ‰ä¸ç®¡ç†å‘˜ç›¸åŒçš„æƒé™ï¼ˆé™¤ç‰¹å®šæƒé™å¤–ï¼‰ï¼Œå¯ä»¥è®¿é—®æ‰€æœ‰éƒ¨é—¨</p>
        <div class="form-row">
          <div class="form-group">
            <label>ç”¨æˆ·å</label>
            <input type="text" id="leaderUsername" placeholder="è¾“å…¥ç”¨æˆ·å">
          </div>
          <div class="form-group">
            <label>å¯†ç </label>
            <input type="password" id="leaderPassword" placeholder="è¾“å…¥å¯†ç ">
          </div>
        </div>
        <div class="form-group">
          <label>å§“å</label>
          <input type="text" id="leaderFullName" placeholder="è¾“å…¥çœŸå®å§“å">
        </div>
        <button class="btn-success btn-small" onclick="registerLeader()" style="width: auto;">
          â• æ³¨å†Œé¢†å¯¼è´¦å·
        </button>
      </div>
      
      <div class="section">
        <div class="section-title">æ³¨å†Œéƒ¨é—¨ç»ç†</div>
        <p class="hint" style="margin-bottom: 15px;">éƒ¨é—¨ç»ç†åªèƒ½ç®¡ç†å’ŒæŸ¥çœ‹æœ¬éƒ¨é—¨çš„é¡¹ç›®å’Œå‘˜å·¥</p>
        <div class="form-row-3">
          <div class="form-group">
            <label>ç”¨æˆ·å</label>
            <input type="text" id="managerUsername" placeholder="è¾“å…¥ç”¨æˆ·å">
          </div>
          <div class="form-group">
            <label>å¯†ç </label>
            <input type="password" id="managerPassword" placeholder="è¾“å…¥å¯†ç ">
          </div>
          <div class="form-group">
            <label>å§“å</label>
            <input type="text" id="managerFullName" placeholder="è¾“å…¥çœŸå®å§“å">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>æ‰€å±éƒ¨é—¨</label>
            <select id="managerDepartment">
              <option value="design">è®¾è®¡éƒ¨</option>
              <option value="procurement">é‡‡è´­éƒ¨</option>
              <option value="production">ç”Ÿäº§éƒ¨</option>
              <option value="assembly">è£…è°ƒéƒ¨</option>
              <option value="electrical">ç”µæ°”éƒ¨</option>
              <option value="quality">è´¨é‡éƒ¨</option>
            </select>
          </div>
          <div class="form-group">
            <label>èŒä½</label>
            <select id="managerRole">
              <option value="manager">éƒ¨é—¨ç»ç†</option>
              <option value="deputy_manager">å‰¯ç»ç†</option>
            </select>
          </div>
        </div>
        <button class="btn-success btn-small" onclick="registerManager()" style="width: auto;">
          â• æ³¨å†Œéƒ¨é—¨ç»ç†
        </button>
      </div>
      
      <div class="section">
        <div class="section-title">æ³¨å†Œæ™®é€šå‘˜å·¥</div>
        <p class="hint" style="margin-bottom: 15px;">æ™®é€šå‘˜å·¥åªèƒ½æŸ¥çœ‹å’Œå¤„ç†åˆ†é…ç»™è‡ªå·±çš„ä»»åŠ¡</p>
        <div class="form-row-3">
          <div class="form-group">
            <label>ç”¨æˆ·å</label>
            <input type="text" id="employeeUsername" placeholder="è¾“å…¥ç”¨æˆ·å">
          </div>
          <div class="form-group">
            <label>å¯†ç </label>
            <input type="password" id="employeePassword" placeholder="è¾“å…¥å¯†ç ">
          </div>
          <div class="form-group">
            <label>å§“å</label>
            <input type="text" id="employeeFullName" placeholder="è¾“å…¥çœŸå®å§“å">
          </div>
        </div>
        <div class="form-group">
          <label>æ‰€å±éƒ¨é—¨</label>
          <select id="employeeDepartment">
            <option value="design">è®¾è®¡éƒ¨</option>
            <option value="procurement">é‡‡è´­éƒ¨</option>
            <option value="production">ç”Ÿäº§éƒ¨</option>
            <option value="assembly">è£…è°ƒéƒ¨</option>
            <option value="electrical">ç”µæ°”éƒ¨</option>
            <option value="quality">è´¨é‡éƒ¨</option>
          </select>
        </div>
        <button class="btn-success btn-small" onclick="registerEmployee()" style="width: auto;">
          â• æ³¨å†Œå‘˜å·¥è´¦å·
        </button>
      </div>
      
      <div class="info-box">
        <h4>ğŸ“‹ æƒé™è¯´æ˜</h4>
        <p>
          <strong>ç®¡ç†å‘˜</strong>ï¼šæœ€é«˜æƒé™ï¼Œå¯åˆ›å»ºé¡¹ç›®ã€ç®¡ç†æ‰€æœ‰ç”¨æˆ·<br>
          <strong>é¢†å¯¼</strong>ï¼šä¸ç®¡ç†å‘˜ç›¸åŒæƒé™ï¼ˆé™¤åˆ›å»ºé¡¹ç›®å¤–ï¼‰ï¼Œå¯æŸ¥çœ‹æ‰€æœ‰éƒ¨é—¨<br>
          <strong>éƒ¨é—¨ç»ç†/å‰¯ç»ç†</strong>ï¼šç®¡ç†æœ¬éƒ¨é—¨é¡¹ç›®åˆ†é…ï¼Œåªèƒ½æŸ¥çœ‹æœ¬éƒ¨é—¨ä¿¡æ¯<br>
          <strong>æ™®é€šå‘˜å·¥</strong>ï¼šåªèƒ½æŸ¥çœ‹å’Œå¤„ç†åˆ†é…ç»™è‡ªå·±çš„ä»»åŠ¡
        </p>
      </div>
    </div>
    
    <!-- æ•°æ®å¤‡ä»½ -->
    <div class="tab-content" id="tab-backup">
      <div class="stats-grid">
        <div class="stat-card admin">
          <div class="number" id="dataUsers">0</div>
          <div class="label">ç”¨æˆ·æ•°</div>
        </div>
        <div class="stat-card leader">
          <div class="number" id="dataProjects">0</div>
          <div class="label">é¡¹ç›®æ•°</div>
        </div>
        <div class="stat-card manager">
          <div class="number" id="dataProcesses">0</div>
          <div class="label">å·¥åºæ•°</div>
        </div>
        <div class="stat-card employee">
          <div class="number" id="dataBackups">0</div>
          <div class="label">å¤‡ä»½æ•°</div>
        </div>
      </div>
      
      <div class="section">
        <div class="section-title">è‡ªåŠ¨å¤‡ä»½</div>
        <p class="hint" style="margin-bottom: 15px;">å¼€å¯åæ¯20åˆ†é’Ÿè‡ªåŠ¨å¤‡ä»½ä¸€æ¬¡ï¼Œä¼šè¦†ç›–å‰ä¸€æ¬¡çš„è‡ªåŠ¨å¤‡ä»½ï¼ˆåŒ…å«æœåŠ¡å™¨é…ç½®å’Œç®¡ç†ç³»ç»Ÿæ•°æ®ï¼‰</p>
        <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 15px;">
          <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
            <input type="checkbox" id="autoBackupToggle" onchange="toggleAutoBackup()" style="width: 18px; height: 18px; cursor: pointer;">
            <span style="font-weight: 500;">å¯ç”¨è‡ªåŠ¨å¤‡ä»½</span>
          </label>
          <span id="autoBackupStatus" style="color: #888; font-size: 13px;">æœªå¯ç”¨</span>
        </div>
        <div id="autoBackupInfo" style="background: #f0fdf4; border: 1px solid #86efac; border-radius: 8px; padding: 12px; display: none;">
          <div style="display: flex; align-items: center; gap: 8px; color: #166534;">
            <span>âœ…</span>
            <span>ä¸Šæ¬¡è‡ªåŠ¨å¤‡ä»½æ—¶é—´ï¼š<strong id="lastAutoBackupTime">-</strong></span>
          </div>
        </div>
      </div>
      
      <div class="section">
        <div class="section-title">æ‰‹åŠ¨å¤‡ä»½</div>
        <p class="hint" style="margin-bottom: 15px;">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®åˆ›å»ºå½“å‰æ•°æ®çš„å¤‡ä»½ï¼Œå¤‡ä»½æ–‡ä»¶ä¿å­˜åœ¨ server/data/backups ç›®å½•</p>
        <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 15px;">
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <input type="checkbox" id="includeConfigCheckbox" style="width: 16px; height: 16px; cursor: pointer;">
            <span style="font-size: 14px;">åŒæ—¶å¤‡ä»½æœåŠ¡å™¨é…ç½®</span>
          </label>
        </div>
        <button class="btn-success" onclick="createBackup()" style="width: auto;">
          ğŸ“¦ ç«‹å³åˆ›å»ºå¤‡ä»½
        </button>
      </div>
      
      <div class="section">
        <div class="section-title">å¤‡ä»½åˆ—è¡¨</div>
        <div id="backupListContainer">
          <table class="user-table">
            <thead>
              <tr>
                <th>å¤‡ä»½åç§°</th>
                <th>ç±»å‹</th>
                <th>åˆ›å»ºæ—¶é—´</th>
                <th>åŒ…å«æ–‡ä»¶</th>
                <th>æ“ä½œ</th>
              </tr>
            </thead>
            <tbody id="backupTableBody">
              <tr><td colspan="5" class="empty-state">åŠ è½½ä¸­...</td></tr>
            </tbody>
          </table>
        </div>
      </div>
      
      <div class="buttons">
        <button class="btn-secondary" onclick="loadBackups()">
          ğŸ”„ åˆ·æ–°åˆ—è¡¨
        </button>
      </div>
      
      <div class="info-box">
        <h4>ğŸ’¡ å¤‡ä»½è¯´æ˜</h4>
        <p>
          <strong>å¤‡ä»½å†…å®¹</strong>ï¼šç”¨æˆ·æ•°æ®ã€é¡¹ç›®æ•°æ®ã€å·¥åºæ•°æ®ã€æ—¥æŠ¥æ•°æ®ã€æœåŠ¡å™¨é…ç½®<br>
          <strong>å¤‡ä»½ä½ç½®</strong>ï¼šserver/data/backups/ ç›®å½•<br>
          <strong>è‡ªåŠ¨å¤‡ä»½</strong>ï¼šæ¯20åˆ†é’Ÿè‡ªåŠ¨å¤‡ä»½ä¸€æ¬¡ï¼Œè¦†ç›–å‰ä¸€æ¬¡è‡ªåŠ¨å¤‡ä»½<br>
          <strong>æ¢å¤æ“ä½œ</strong>ï¼šæ¢å¤å‰ä¼šè‡ªåŠ¨åˆ›å»ºå½“å‰æ•°æ®çš„å¤‡ä»½<br>
          <strong>å»ºè®®</strong>ï¼šå®šæœŸæ‰‹åŠ¨å¤‡ä»½é‡è¦æ•°æ®ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±
        </p>
      </div>
    </div>
    
    <div class="footer">
      å…¬å¸ç®¡ç†ç³»ç»Ÿ v3.0.0 | æœåŠ¡å™¨é…ç½®ä¸ç”¨æˆ·ç®¡ç†
    </div>
  </div>
  
  <div class="toast" id="toast"></div>
  
  <script>
    // ç”¨æˆ·æ•°æ®ç¼“å­˜
    let allUsers = [];
    
    // åˆ‡æ¢æ ‡ç­¾é¡µ
    function switchTab(tabName) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      
      const tabIndex = { server: 1, users: 2, managers: 3, backup: 4 };
      document.querySelector(`.tab:nth-child(${tabIndex[tabName]})`).classList.add('active');
      document.getElementById('tab-' + tabName).classList.add('active');
      
      if (tabName === 'users') {
        loadUsers();
      }
      if (tabName === 'backup') {
        loadBackups();
        loadDataStats();
      }
    }
    
    // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
    function showToast(message, type = 'info') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = 'toast show ' + type;
      setTimeout(() => {
        toast.className = 'toast';
      }, 3000);
    }
    
    // åŠ è½½é…ç½®
    async function loadConfig() {
      try {
        const response = await fetch('/api/config');
        const data = await response.json();
        
        if (data.server) {
          document.getElementById('port').value = data.server.port || 3000;
          document.getElementById('host').value = data.server.host || '0.0.0.0';
        }
        if (data.app) {
          document.getElementById('appTitle').value = data.app.title || 'å…¬å¸ç®¡ç†ç³»ç»Ÿ';
          document.getElementById('appVersion').value = data.app.version || '3.0.0';
        }
        if (data.inviteCode) {
          document.getElementById('inviteCode').value = data.inviteCode;
        }
        
        showToast('é…ç½®å·²åŠ è½½', 'success');
      } catch (e) {
        showToast('åŠ è½½é…ç½®å¤±è´¥', 'error');
      }
    }
    
    // ä¿å­˜é…ç½®
    async function saveConfig() {
      const config = {
        server: {
          port: parseInt(document.getElementById('port').value),
          host: document.getElementById('host').value
        },
        app: {
          title: document.getElementById('appTitle').value,
          version: document.getElementById('appVersion').value
        },
        security: {
          inviteCode: document.getElementById('inviteCode').value
        },
        database: {
          type: 'file',
          dataDir: './data'
        }
      };
      
      try {
        const response = await fetch('/api/save-config', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(config)
        });
        
        if (response.ok) {
          showToast('é…ç½®å·²ä¿å­˜ï¼Œè¯·é‡å¯æœåŠ¡å™¨ç”Ÿæ•ˆ', 'success');
        } else {
          showToast('ä¿å­˜å¤±è´¥', 'error');
        }
      } catch (e) {
        showToast('ä¿å­˜å¤±è´¥: ' + e.message, 'error');
      }
    }
    
    // è§’è‰²å’Œéƒ¨é—¨åç§°æ˜ å°„
    const roleNames = {
      'admin': 'ç®¡ç†å‘˜',
      'leader': 'é¢†å¯¼',
      'manager': 'éƒ¨é—¨ç»ç†',
      'deputy_manager': 'å‰¯ç»ç†',
      'employee': 'å‘˜å·¥'
    };
    
    const roleBadges = {
      'admin': 'badge-admin',
      'leader': 'badge-leader',
      'manager': 'badge-manager',
      'deputy_manager': 'badge-deputy',
      'employee': 'badge-employee'
    };
    
    const deptNames = {
      'admin': 'ç³»ç»Ÿ',
      'leader': 'é¢†å¯¼å±‚',
      'design': 'è®¾è®¡éƒ¨',
      'procurement': 'é‡‡è´­éƒ¨',
      'production': 'ç”Ÿäº§éƒ¨',
      'assembly': 'è£…è°ƒéƒ¨',
      'electrical': 'ç”µæ°”éƒ¨',
      'quality': 'è´¨é‡éƒ¨'
    };
    
    // åŠ è½½ç”¨æˆ·åˆ—è¡¨
    async function loadUsers() {
      const tbody = document.getElementById('userTableBody');
      
      try {
        const response = await fetch('/api/users');
        allUsers = await response.json();
        
        updateStats();
        renderUsers(allUsers);
        
      } catch (e) {
        tbody.innerHTML = '<tr><td colspan="6" class="empty-state">åŠ è½½å¤±è´¥</td></tr>';
      }
    }
    
    // æ›´æ–°ç»Ÿè®¡æ•°æ®
    function updateStats() {
      document.getElementById('adminCount').textContent = allUsers.filter(u => u.role === 'admin').length;
      document.getElementById('leaderCount').textContent = allUsers.filter(u => u.role === 'leader').length;
      document.getElementById('managerCount').textContent = allUsers.filter(u => u.role === 'manager' || u.role === 'deputy_manager').length;
      document.getElementById('employeeCount').textContent = allUsers.filter(u => u.role === 'employee').length;
    }
    
    // ç­›é€‰ç”¨æˆ·
    function filterUsers() {
      const roleFilter = document.getElementById('filterRole').value;
      const deptFilter = document.getElementById('filterDept').value;
      
      let filtered = allUsers;
      
      if (roleFilter) {
        filtered = filtered.filter(u => u.role === roleFilter);
      }
      
      if (deptFilter) {
        filtered = filtered.filter(u => u.department === deptFilter);
      }
      
      renderUsers(filtered);
    }
    
    // æ¸²æŸ“ç”¨æˆ·è¡¨æ ¼
    function renderUsers(users) {
      const tbody = document.getElementById('userTableBody');
      
      if (users.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" class="empty-state">æš‚æ— ç”¨æˆ·</td></tr>';
        return;
      }
      
      tbody.innerHTML = users.map(user => `
        <tr>
          <td><strong>${user.username}</strong></td>
          <td>${user.fullName || '-'}</td>
          <td><span class="badge ${roleBadges[user.role] || 'badge-employee'}">${roleNames[user.role] || user.role}</span></td>
          <td>${user.department ? `<span class="dept-badge">${deptNames[user.department] || user.department}</span>` : '-'}</td>
          <td>${user.createdAt ? new Date(user.createdAt).toLocaleDateString() : '-'}</td>
          <td>
            ${user.role !== 'admin' ? `<button class="btn-danger btn-small" onclick="deleteUser('${user.username}')">åˆ é™¤</button>` : '<span style="color:#999">-</span>'}
          </td>
        </tr>
      `).join('');
    }
    
    // åˆ é™¤ç”¨æˆ·
    async function deleteUser(username) {
      if (!confirm(`ç¡®å®šè¦åˆ é™¤ç”¨æˆ· "${username}" å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼`)) return;
      
      try {
        const response = await fetch('/api/users/' + username, {
          method: 'DELETE'
        });
        
        if (response.ok) {
          showToast('ç”¨æˆ·å·²åˆ é™¤', 'success');
          loadUsers();
        } else {
          const data = await response.json();
          showToast(data.error || 'åˆ é™¤å¤±è´¥', 'error');
        }
      } catch (e) {
        showToast('åˆ é™¤å¤±è´¥: ' + e.message, 'error');
      }
    }
    
    // æ³¨å†Œé¢†å¯¼è´¦å·
    async function registerLeader() {
      const username = document.getElementById('leaderUsername').value.trim();
      const password = document.getElementById('leaderPassword').value;
      const fullName = document.getElementById('leaderFullName').value.trim();
      
      if (!username || !password || !fullName) {
        showToast('è¯·å¡«å†™æ‰€æœ‰å­—æ®µ', 'error');
        return;
      }
      
      try {
        const response = await fetch('/api/register-manager', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            username,
            password,
            fullName,
            role: 'leader',
            department: 'leader'
          })
        });
        
        if (response.ok) {
          showToast('é¢†å¯¼è´¦å·æ³¨å†ŒæˆåŠŸ', 'success');
          document.getElementById('leaderUsername').value = '';
          document.getElementById('leaderPassword').value = '';
          document.getElementById('leaderFullName').value = '';
        } else {
          const data = await response.json();
          showToast(data.error || 'æ³¨å†Œå¤±è´¥', 'error');
        }
      } catch (e) {
        showToast('æ³¨å†Œå¤±è´¥: ' + e.message, 'error');
      }
    }
    
    // æ³¨å†Œéƒ¨é—¨ç»ç†
    async function registerManager() {
      const username = document.getElementById('managerUsername').value.trim();
      const password = document.getElementById('managerPassword').value;
      const fullName = document.getElementById('managerFullName').value.trim();
      const department = document.getElementById('managerDepartment').value;
      const role = document.getElementById('managerRole').value;
      
      if (!username || !password || !fullName) {
        showToast('è¯·å¡«å†™æ‰€æœ‰å­—æ®µ', 'error');
        return;
      }
      
      try {
        const response = await fetch('/api/register-manager', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            username,
            password,
            fullName,
            role,
            department
          })
        });
        
        if (response.ok) {
          showToast('éƒ¨é—¨ç»ç†æ³¨å†ŒæˆåŠŸ', 'success');
          document.getElementById('managerUsername').value = '';
          document.getElementById('managerPassword').value = '';
          document.getElementById('managerFullName').value = '';
        } else {
          const data = await response.json();
          showToast(data.error || 'æ³¨å†Œå¤±è´¥', 'error');
        }
      } catch (e) {
        showToast('æ³¨å†Œå¤±è´¥: ' + e.message, 'error');
      }
    }
    
    // æ³¨å†Œæ™®é€šå‘˜å·¥
    async function registerEmployee() {
      const username = document.getElementById('employeeUsername').value.trim();
      const password = document.getElementById('employeePassword').value;
      const fullName = document.getElementById('employeeFullName').value.trim();
      const department = document.getElementById('employeeDepartment').value;
      
      if (!username || !password || !fullName) {
        showToast('è¯·å¡«å†™æ‰€æœ‰å­—æ®µ', 'error');
        return;
      }
      
      try {
        const response = await fetch('/api/register-manager', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            username,
            password,
            fullName,
            role: 'employee',
            department
          })
        });
        
        if (response.ok) {
          showToast('å‘˜å·¥è´¦å·æ³¨å†ŒæˆåŠŸ', 'success');
          document.getElementById('employeeUsername').value = '';
          document.getElementById('employeePassword').value = '';
          document.getElementById('employeeFullName').value = '';
        } else {
          const data = await response.json();
          showToast(data.error || 'æ³¨å†Œå¤±è´¥', 'error');
        }
      } catch (e) {
        showToast('æ³¨å†Œå¤±è´¥: ' + e.message, 'error');
      }
    }
    
    // æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€
    async function checkStatus() {
      const indicator = document.getElementById('statusIndicator');
      const text = document.getElementById('statusText');
      
      try {
        const response = await fetch('/api/health');
        const data = await response.json();
        
        if (data.status === 'ok') {
          indicator.className = 'status-indicator running';
          text.textContent = 'æœåŠ¡å™¨è¿è¡Œä¸­ - ç‰ˆæœ¬ ' + data.version;
        }
      } catch (e) {
        indicator.className = 'status-indicator stopped';
        text.textContent = 'æœåŠ¡å™¨æœªè¿è¡Œ';
      }
    }
    
    // è‡ªåŠ¨å¤‡ä»½å®šæ—¶å™¨
    let autoBackupInterval = null;
    const AUTO_BACKUP_INTERVAL = 20 * 60 * 1000; // 20åˆ†é’Ÿ
    
    // åˆ›å»ºæ‰‹åŠ¨å¤‡ä»½
    async function createBackup() {
      try {
        const includeConfig = document.getElementById('includeConfigCheckbox').checked;
        const response = await fetch('/api/backup', { 
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ includeConfig })
        });
        const data = await response.json();
        
        if (data.success) {
          showToast('å¤‡ä»½åˆ›å»ºæˆåŠŸ: ' + data.backup.name, 'success');
          loadBackups();
          loadDataStats();
        } else {
          showToast(data.error || 'å¤‡ä»½å¤±è´¥', 'error');
        }
      } catch (e) {
        showToast('å¤‡ä»½å¤±è´¥: ' + e.message, 'error');
      }
    }
    
    // åˆ›å»ºè‡ªåŠ¨å¤‡ä»½
    async function createAutoBackup() {
      try {
        const response = await fetch('/api/backup/auto', { method: 'POST' });
        const data = await response.json();
        
        if (data.success) {
          console.log('è‡ªåŠ¨å¤‡ä»½æˆåŠŸ:', data.backup.timestamp);
          updateAutoBackupInfo(data.backup);
          loadBackups();
          loadDataStats();
        }
      } catch (e) {
        console.error('è‡ªåŠ¨å¤‡ä»½å¤±è´¥:', e.message);
      }
    }
    
    // åˆ‡æ¢è‡ªåŠ¨å¤‡ä»½
    function toggleAutoBackup() {
      const toggle = document.getElementById('autoBackupToggle');
      const statusText = document.getElementById('autoBackupStatus');
      
      if (toggle.checked) {
        // å¯ç”¨è‡ªåŠ¨å¤‡ä»½
        createAutoBackup(); // ç«‹å³æ‰§è¡Œä¸€æ¬¡
        autoBackupInterval = setInterval(createAutoBackup, AUTO_BACKUP_INTERVAL);
        statusText.textContent = 'å·²å¯ç”¨ï¼ˆæ¯20åˆ†é’Ÿå¤‡ä»½ä¸€æ¬¡ï¼‰';
        statusText.style.color = '#22c55e';
        localStorage.setItem('autoBackupEnabled', 'true');
        showToast('è‡ªåŠ¨å¤‡ä»½å·²å¯ç”¨', 'success');
      } else {
        // ç¦ç”¨è‡ªåŠ¨å¤‡ä»½
        if (autoBackupInterval) {
          clearInterval(autoBackupInterval);
          autoBackupInterval = null;
        }
        statusText.textContent = 'æœªå¯ç”¨';
        statusText.style.color = '#888';
        localStorage.setItem('autoBackupEnabled', 'false');
        showToast('è‡ªåŠ¨å¤‡ä»½å·²ç¦ç”¨', 'info');
      }
    }
    
    // æ›´æ–°è‡ªåŠ¨å¤‡ä»½ä¿¡æ¯æ˜¾ç¤º
    function updateAutoBackupInfo(backup) {
      const infoDiv = document.getElementById('autoBackupInfo');
      const timeSpan = document.getElementById('lastAutoBackupTime');
      
      if (backup && backup.timestamp) {
        infoDiv.style.display = 'block';
        timeSpan.textContent = new Date(backup.timestamp).toLocaleString();
      } else {
        infoDiv.style.display = 'none';
      }
    }
    
    // åŠ è½½è‡ªåŠ¨å¤‡ä»½çŠ¶æ€
    async function loadAutoBackupStatus() {
      try {
        const response = await fetch('/api/backup/auto/status');
        const data = await response.json();
        
        if (data.exists) {
          updateAutoBackupInfo(data.backup);
        }
        
        // æ¢å¤è‡ªåŠ¨å¤‡ä»½çŠ¶æ€
        const autoBackupEnabled = localStorage.getItem('autoBackupEnabled') === 'true';
        const toggle = document.getElementById('autoBackupToggle');
        const statusText = document.getElementById('autoBackupStatus');
        
        if (autoBackupEnabled) {
          toggle.checked = true;
          statusText.textContent = 'å·²å¯ç”¨ï¼ˆæ¯20åˆ†é’Ÿå¤‡ä»½ä¸€æ¬¡ï¼‰';
          statusText.style.color = '#22c55e';
          autoBackupInterval = setInterval(createAutoBackup, AUTO_BACKUP_INTERVAL);
        }
      } catch (e) {
        console.error('åŠ è½½è‡ªåŠ¨å¤‡ä»½çŠ¶æ€å¤±è´¥:', e);
      }
    }
    
    // è·å–å¤‡ä»½ç±»å‹åç§°
    function getBackupTypeName(type) {
      const typeNames = {
        'manual': 'æ‰‹åŠ¨å¤‡ä»½',
        'auto': 'è‡ªåŠ¨å¤‡ä»½',
        'auto_before_restore': 'æ¢å¤å‰è‡ªåŠ¨å¤‡ä»½'
      };
      return typeNames[type] || 'æ‰‹åŠ¨å¤‡ä»½';
    }
    
    // è·å–å¤‡ä»½ç±»å‹æ ·å¼
    function getBackupTypeBadge(type) {
      const typeStyles = {
        'manual': 'background: #dbeafe; color: #2563eb;',
        'auto': 'background: #dcfce7; color: #16a34a;',
        'auto_before_restore': 'background: #fef3c7; color: #d97706;'
      };
      return typeStyles[type] || typeStyles['manual'];
    }
    
    // åŠ è½½å¤‡ä»½åˆ—è¡¨
    async function loadBackups() {
      const tbody = document.getElementById('backupTableBody');
      
      try {
        const response = await fetch('/api/backups');
        const backups = await response.json();
        
        if (backups.length === 0) {
          tbody.innerHTML = '<tr><td colspan="5" class="empty-state">æš‚æ— å¤‡ä»½</td></tr>';
          return;
        }
        
        tbody.innerHTML = backups.map(backup => `
          <tr>
            <td><strong>${backup.name}</strong></td>
            <td><span class="badge" style="${getBackupTypeBadge(backup.type)}">${getBackupTypeName(backup.type)}</span></td>
            <td>${new Date(backup.timestamp).toLocaleString()}</td>
            <td>${backup.files ? backup.files.join(', ') : '-'}</td>
            <td>
              <button class="btn-success btn-small" onclick="restoreBackup('${backup.name}')"æ¢å¤</button>
              <button class="btn-danger btn-small" onclick="deleteBackup('${backup.name}')"åˆ é™¤</button>
            </td>
          </tr>
        `).join('');
      } catch (e) {
        tbody.innerHTML = '<tr><td colspan="5" class="empty-state">åŠ è½½å¤±è´¥</td></tr>';
      }
    }
    
    // æ¢å¤å¤‡ä»½
    async function restoreBackup(backupName) {
      if (!confirm(`ç¡®å®šè¦æ¢å¤å¤‡ä»½ "${backupName}" å—ï¼Ÿ\n\næ³¨æ„ï¼š\n1. æ¢å¤å‰ä¼šè‡ªåŠ¨åˆ›å»ºå½“å‰æ•°æ®çš„å¤‡ä»½\n2. å¦‚æœå¤‡ä»½åŒ…å«é…ç½®æ–‡ä»¶ï¼Œé…ç½®ä¹Ÿä¼šè¢«æ¢å¤\n3. æ¢å¤åç®¡ç†ç³»ç»Ÿæ•°æ®ä¼šè‡ªåŠ¨åŒæ­¥`)) return;
      
      try {
        const response = await fetch('/api/restore/' + encodeURIComponent(backupName), { method: 'POST' });
        const data = await response.json();
        
        if (data.success) {
          let msg = 'æ•°æ®å·²æ¢å¤ï¼Œå·²è‡ªåŠ¨å¤‡ä»½åŸæ•°æ®: ' + data.autoBackup;
          if (data.restored.includes('config.json')) {
            msg += '\né…ç½®æ–‡ä»¶å·²æ¢å¤ï¼Œå»ºè®®é‡å¯æœåŠ¡å™¨ä»¥åº”ç”¨æ–°é…ç½®';
          }
          showToast(msg, 'success');
          loadBackups();
          loadDataStats();
          loadConfig(); // é‡æ–°åŠ è½½é…ç½®
          
          // è‡ªåŠ¨åŒæ­¥æ•°æ®åˆ°ç®¡ç†ç³»ç»Ÿ
          try {
            const syncResponse = await fetch('/api/sync-data');
            const syncData = await syncResponse.json();
            
            // å°†æ•°æ®å­˜å‚¨åˆ°sessionStorageï¼Œç®¡ç†ç³»ç»Ÿé¡µé¢åŠ è½½æ—¶ä¼šè¯»å–
            sessionStorage.setItem('pendingRestore', JSON.stringify({
              projects: syncData.projects || [],
              processes: syncData.processes || [],
              dailyReports: syncData.dailyReports || [],
              timestamp: Date.now()
            }));
            
            // å¼¹å‡ºæç¤ºæ¡†æé†’ç”¨æˆ·
            const shouldOpen = confirm('æ•°æ®å·²æ¢å¤ï¼\n\nç‚¹å‡»"ç¡®å®š"æ‰“å¼€ç®¡ç†ç³»ç»Ÿé¡µé¢å¹¶è‡ªåŠ¨åŒæ­¥æ•°æ®ï¼Œ\nç‚¹å‡»"å–æ¶ˆ"ç¨åæ‰‹åŠ¨åˆ·æ–°ç®¡ç†ç³»ç»Ÿé¡µé¢ã€‚');
            
            if (shouldOpen) {
              // æ‰“å¼€ç®¡ç†ç³»ç»Ÿé¡µé¢ï¼Œå¸¦ä¸ŠåŒæ­¥å‚æ•°
              window.open('/?restore=true&t=' + Date.now(), '_blank');
            }
          } catch (syncError) {
            console.error('åŒæ­¥æ•°æ®å¤±è´¥:', syncError);
            alert('æ•°æ®å·²æ¢å¤ï¼\n\nè¯·æ‰‹åŠ¨åˆ·æ–°ç®¡ç†ç³»ç»Ÿé¡µé¢ä»¥åŠ è½½æ¢å¤çš„æ•°æ®ã€‚');
          }
        } else {
          showToast(data.error || 'æ¢å¤å¤±è´¥', 'error');
        }
      } catch (e) {
        showToast('æ¢å¤å¤±è´¥: ' + e.message, 'error');
      }
    }
    
    // åˆ é™¤å¤‡ä»½
    async function deleteBackup(backupName) {
      if (!confirm(`ç¡®å®šè¦åˆ é™¤å¤‡ä»½ "${backupName}" å—ï¼Ÿ\n\næ­¤æ“ä½œä¸å¯æ¢å¤ï¼`)) return;
      
      try {
        const response = await fetch('/api/backup/' + encodeURIComponent(backupName), { method: 'DELETE' });
        const data = await response.json();
        
        if (data.success) {
          showToast('å¤‡ä»½å·²åˆ é™¤', 'success');
          loadBackups();
          loadDataStats();
        } else {
          showToast(data.error || 'åˆ é™¤å¤±è´¥', 'error');
        }
      } catch (e) {
        showToast('åˆ é™¤å¤±è´¥: ' + e.message, 'error');
      }
    }
    
    // åŠ è½½æ•°æ®ç»Ÿè®¡
    async function loadDataStats() {
      try {
        const response = await fetch('/api/data-stats');
        const stats = await response.json();
        
        document.getElementById('dataUsers').textContent = stats.users || 0;
        document.getElementById('dataProjects').textContent = stats.projects || 0;
        document.getElementById('dataProcesses').textContent = stats.processes || 0;
        document.getElementById('dataBackups').textContent = stats.backups || 0;
      } catch (e) {
        console.error('åŠ è½½ç»Ÿè®¡å¤±è´¥:', e);
      }
    }
    
    // åˆå§‹åŒ–
    window.onload = function() {
      checkStatus();
      loadConfig();
      loadAutoBackupStatus();
      setInterval(checkStatus, 5000);
    };
  </script>
</body>
</html>
